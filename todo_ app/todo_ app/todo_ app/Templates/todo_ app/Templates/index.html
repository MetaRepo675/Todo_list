{% extends "base.html" %}

{% block content %}
<div class="todo-container">
    <!-- فرم افزودن وظیفه جدید -->
    <div class="add-form">
        <h2><i class="fas fa-plus-circle"></i> افزودن وظیفه جدید</h2>
        <form method="POST" action="{{ url_for('add_todo') }}">
            <div class="form-group">
                <input type="text" name="task" placeholder="عنوان وظیفه *" required>
            </div>
            <div class="form-group">
                <textarea name="description" placeholder="توضیحات (اختیاری)" rows="3"></textarea>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>اولویت:</label>
                    <select name="priority">
                        <option value="1">عادی</option>
                        <option value="2">مهم</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>تاریخ انجام:</label>
                    <input type="date" name="due_date">
                </div>
            </div>
            <button type="submit" class="btn btn-primary">
                <i class="fas fa-save"></i> ذخیره وظیفه
            </button>
        </form>
    </div>

    <!-- فیلترها -->
    <div class="filters">
        <a href="{{ url_for('index') }}" class="filter-btn {% if not filter_completed %}active{% endif %}">
            همه وظایف
        </a>
        <a href="{{ url_for('index', filter='pending') }}" class="filter-btn {% if filter_completed == 'pending' %}active{% endif %}">
            در انتظار
        </a>
        <a href="{{ url_for('index', filter='completed') }}" class="filter-btn {% if filter_completed == 'completed' %}active{% endif %}">
            تکمیل شده
        </a>
    </div>

    <!-- لیست وظایف -->
    <div class="todo-list">
        <h2><i class="fas fa-list"></i> لیست وظایف</h2>
        
        {% if todos %}
            {% for todo in todos %}
            <div class="todo-item {% if todo['completed'] %}completed{% endif %} priority-{{ todo['priority'] }}">
                <div class="todo-content">
                    <div class="todo-header">
                        <h3>{{ todo['task'] }}</h3>
                        <div class="todo-meta">
                            {% if todo['priority'] == 2 %}
                            <span class="badge badge-important"><i class="fas fa-exclamation-circle"></i> مهم</span>
                            {% endif %}
                            <span class="badge badge-date">
                                <i class="far fa-calendar"></i> 
                                {{ todo['created_at'][:10] if todo['created_at'] else '' }}
                            </span>
                        </div>
                    </div>
                    
                    {% if todo['description'] %}
                    <p class="todo-description">{{ todo['description'] }}</p>
                    {% endif %}
                    
                    {% if todo['due_date'] %}
                    <p class="todo-due-date">
                        <i class="far fa-clock"></i>
                        موعد انجام: {{ todo['due_date'] }}
                    </p>
                    {% endif %}
                </div>
                
                <div class="todo-actions">
                    {% if not todo['completed'] %}
                        <a href="{{ url_for('complete_todo', todo_id=todo['id']) }}" class="btn btn-success" title="تکمیل">
                            <i class="fas fa-check"></i>
                        </a>
                        <a href="{{ url_for('edit_todo', todo_id=todo['id']) }}" class="btn btn-warning" title="ویرایش">
                            <i class="fas fa-edit"></i>
                        </a>
                        <a href="{{ url_for('toggle_priority', todo_id=todo['id']) }}" class="btn btn-info" title="تغییر اولویت">
                            <i class="fas fa-exchange-alt"></i>
                        </a>
                    {% endif %}
                    <a href="{{ url_for('delete_todo', todo_id=todo['id']) }}" class="btn btn-danger" title="حذف" 
                       onclick="return confirm('آیا از حذف این وظیفه اطمینان دارید؟')">
                        <i class="fas fa-trash"></i>
                    </a>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <div class="empty-state">
                <i class="fas fa-clipboard-list fa-3x"></i>
                <h3>هیچ وظیفه‌ای یافت نشد</h3>
                <p>اولین وظیفه خود را اضافه کنید</p>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}
